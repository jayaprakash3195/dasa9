l<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8" />
<title>роЪроороиро┐ро▓рпИ роХрпВроЯрпНроЯрпБ ро░ро╛роЪро┐ роХроЯрпНроЯроорпН (108 рокро╛родроЩрпНроХро│рпН) & ро╡ро┐роорпНроЪрпЛродрпНродро░ро┐ родроЪрпИ</title>
<style>
body { font-family: 'Latha', Arial, sans-serif; background: #fffef8; text-align: center; padding: 18px; margin: 0;}
.south-chart { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-areas:
"r10  r11  r12  r01"
"r09  photo  photo  r02"
"r08  photo  photo  r03"
"r07  r06  r05  r04";
gap: 5px; max-width: 990px; margin: 0 auto 22px;}

#preview { display: auto; max-width: 95%; max-height: 90%; object-fit: contain; border: 1.5px solid #a1c786; margin: auto; box-shadow: 0 1px 6px #d3efe1; background: #f7f7f7;}
.box { background: #fffdf5; border: 2px solid #116504; border-radius: 10px; box-shadow: 0 2px 5px rgba(52, 202, 69, 0.1);
font-size: 12.5px; color: #135417; box-sizing: border-box; display: flex; flex-direction: column; align-items: left;
text-align: left; justify-content: left; padding: 6px 2px; height: 295px; transition: background 0.3s, border-color 0.3s;}
.box:hover { transform: scale(1.01); background: #fff5e6;}
.rasi-name { font-weight: bold; font-size: 15.5px; color: #f20909; margin-bottom: 4px; text-align: center;}
.line { cursor: pointer; width: 100%; border-radius: 4px; padding: 3px 2px; margin-bottom: 1.5px; line-height: 1.5; transition: background 0.3s, color 0.3s;}
.line:hover { background: #e9f0f9; }
.pos-relative { position: relative; }
#suggestions-box {
position: absolute;
top: 100%;
left: 0;
right: 0;
border: 1px solid #aaa;
background: white;
max-height: 140px;
overflow-y: auto;
z-index: 9999;
display: none;
font-size: 0.9em;
}
#suggestions-box div {
padding: 8px 10px;
cursor: pointer;
}
#suggestions-box div:hover {
background: #eef;
}


/* Greens for current dasa pada */
.highlight-pada-dasa { background: #17671a !important; color: #fff !important; font-weight: bold; }
.highlight-pada-puthi { background: #40be4a !important; color: #fff !important; font-weight: bold; }
.highlight-pada-anthara { background: #b9f4ba !important; color: #21572a !important; font-weight: bold; }

.tree-active { font-weight: bold; color: #136d19;  background: #e9ffe6; border-radius: 4px; }
.tree-highlight-dasa { color: #17671a; font-weight:bold;}
.tree-highlight-puthi { color: #40be4a; font-weight:bold;}
.tree-highlight-anthara { color: #3b8733; font-weight:bold;}
.tree-period { color: #706a5a; font-size:93%; margin-left:4px; }
.tree-ul {
list-style: none;
padding-left: 24px;
text-align: left;
margin: 4px 0 8px 0;
font-size: 1em;
}
.tree-li {
margin-top:3.5px; margin-bottom:3.5px;
}
.tree-ul > .tree-li { margin-top:7px; margin-bottom:7px;}
.expand-btn {
font-size: 1.12em;
font-weight: bold;
color: #1b5d1f;
cursor: pointer;
background: #ecefff;
border: none;
border-radius: 4px;
padding: 0 7px;
margin-right: 3px;
margin-left:0;
outline:none;
vertical-align: middle;
}
.expand-btn.expanded { background: #bffff1; color: #0cdd10;}
.highlight-pada-interactive::after { content: "ЁЯМЯ"; }
.highlight-pada-1::before { content: "ЁЯЯй1 "; }
.highlight-pada-2::before { content: "ЁЯЯз2"; }
.highlight-pada-3::before { content: "ЁЯЯж3 "; }
.highlight-pada-4::before { content: "ЁЯЯе4 "; }
.highlight-pada-5::before { content: "ЁЯЯй5 "; }
.highlight-pada-6::before { content: "ЁЯЯз6 "; }
.highlight-pada-7::before { content: "ЁЯЯж7 "; }
.highlight-pada-8::before { content: "ЁЯЯе8 "; }
.highlight-pada-9::before { content: "ЁЯЯй9 "; }
.highlight-pada-10::before { content: "ЁЯЯз10 "; }
.highlight-pada-11::before { content: "ЁЯЯж11 "; }
.highlight-pada-12::before { content: "ЁЯЯе12 "; }
.clicked-pada-1::before { content: "ЁЯЯй1ЁЯМЯ"; }
.highlight-pada-orange::after { content: "ро╡рпИроиро╛роЪро┐"; }
.highlight-pada-blue::after { content: "ро╡родрпИ"; }
.clicked-pada-special::after { content: "ЁЯМЯ "; }
.mode-btn { background: #ede6ff; border: 1.5px solid #15b817; color: #063d0b; border-radius: 6px; font-size: 1.1em; font-weight: bold; margin: 0 8px 5px 0;
padding: 7px 17px; cursor: pointer; transition: background 0.15s; }
.mode-btn.active-mode { background: #36f029; color: #193f04; border-color: #046625; }
.mode-group { margin-bottom:14px;}
.currentbox { margin: 16px auto 24px auto; background: #e8ecf7; border-radius: 10px; box-shadow: 0 2px 6px #87aed9aa; padding: 16px 26px;
font-size: 1.1em; text-align: left; max-width: 670px; }
.dates { color: #100f0f; font-size: 90%; margin-left: 8px;}
.padasplit { margin: 20px auto 20px auto; background: #f4faff; border-radius: 7px; padding: 12px; max-width: 470px; box-shadow: 0 1px 3px #ccc; font-size: 1em; text-align: left;}
.padasplit u {font-weight: bold; color: #444;}
button[type=submit] { background: #2f76d2; color: white; border: none; padding: 6px 12px; border-radius: 5px; font-size: 14px; cursor: pointer; box-shadow: 0 1.5px 4px rgba(0, 0, 0, 0.1); transition: background 0.2s ease;}
button[type=submit]:hover {background: #195ea8;}

.r01 { grid-area: r11; } .r02 { grid-area: r12; } .r03 { grid-area: r01; } .r04 { grid-area: r02; } .r05 { grid-area: r03; } .r06 { grid-area: r04; }
.r07 { grid-area: r05; } .r08 { grid-area: r06; } .r09 { grid-area: r07; } .r10 { grid-area: r08; } .r11 { grid-area: r09; } .r12 { grid-area: r10; } .photo { grid-area: photo; }
@media (max-width: 900px) {
.box { height: auto; }
.south-chart {
grid-template-columns: repeat(2, 1fr);
grid-template-areas:
"r01 r02"
"r03 r04"
"r05 r06"
"r07 r08"
"r09 r10"
"r11 r12"
}
.currentbox,.padasplit { margin: 10px auto; font-size: 95%;}
}
#current { margin-bottom: 24px;}
/* ... copy/keep remaining style blocks as per your second file ... */
</style>
</head>
<body>
<h2>  ЁЯМЯ<span style="color:#175397;">Jps Astro Research </span> ЁЯМЯ</h2>

<!-- ===== INTEGRATED API POWERED FORM (from your first file) ===== -->
<form id="astroForm" autocomplete="off" style="margin:0 auto 30px auto;">
<label for="dob">рокро┐ро▒роирпНрод родрпЗродро┐:</label>
<input type="date" id="dob_api" required />
<label for="tob">рокро┐ро▒роирпНрод роирпЗро░роорпН:</label>
<input type="time" id="tob_api" required />
<label for="placeInput">рокро┐ро▒роирпНрод роЗроЯроорпН:</label>
<div class="pos-relative">
<input type="text" id="placeInput" placeholder="родрпКроЯроЩрпНроХрпБроЩрпНроХро│рпН..." required autocomplete="off" />
<div id="suggestions-box"></div>
</div>
<button type="submit" style="margin-top:16px;">API роорпВро▓роорпН роХрогроХрпНроХро┐роЯрпБ</button>
<pre id="apiResult"></pre>
<div id="planetsTable"></div>
<table id="planetsDmsTable" style="width:100%; border-collapse: collapse; margin-top:16px;">
<thead>
<tr>
<th style="border:1px solid #ccc; padding:8px;">Planet</th>
<th style="border:1px solid #ccc; padding:8px;">Degrees (┬░ ' ")</th>
<th style="border:1px solid #ccc; padding:8px;">Nakshatra - Pada</th>
<th style="border:1px solid #ccc; padding:8px;">Rasi</th>
<th style="border:1px solid #ccc; padding:8px;">Rasi Owner</th>
<th style="border:1px solid #ccc; padding:8px;">Nakshatra Owner</th>
</tr>
</thead>
<tbody></tbody>
</table>

</form>
<br/>

<!-- ==== MANUAL DEGREE INPUTS & ADVANCED LOGIC (from your second file) ==== -->
<form onsubmit="event.preventDefault(); run();" style="margin:0 auto 20px auto;">
<div style="margin-bottom:6px;">
<label>рокро┐ро▒роирпНрод родрпЗродро┐: <input type="date" id="dob" required></label>
<span class="moonbox" style="margin-left:8px;">
роЪроирпНродро┐ро░ройрпН Degree :
<input type="number" id="moon_deg" min="0" max="359" step="1" required style="width:38px;">┬░
<input type="number" id="moon_min" min="0" max="59"  step="1" required style="width:38px;">'
<input type="number" id="moon_sec" min="0" max="59"  step="1" required style="width:38px;">"
</span>
<span style="margin-left:8px;">
ро▓роХрпНройроорпН Degree :
<input type="number" id="lagna_deg" min="0" max="359" step="1" style="width:45px;">┬░
<input type="number" id="lagna_min" min="0" max="59" step="1" style="width:45px;">'
<input type="number" id="lagna_sec" min="0" max="59" step="1" style="width:45px;">"
</span>
</div>
<div style="margin-bottom: 6px;">
<label>роХрогро┐рокрпНрокрпБроХрпНроХро╛рой родрпЗродро┐: <input type="datetime-local" id="caldate" style="width:210px;"></label>
</div>
<button type="submit" style="margin-left:0;">роХрогроХрпНроХро┐роЯрпБ</button>
<div></div>
</form>
<br/>



<br/>


<div class="south-chart" id="rasiChart"></div>

<div class="mode-group">
<button id="btn-current" class="mode-btn active-mode">родро▒рпНрокрпЛродрпИроп родроЪро╛/рокрпБроХрпНродро┐/роЕроирпНродро░роорпН</button>
<button id="btn-range" class="mode-btn">роЕрокро┐роЬро┐родрпН/ро╡рпИроиро╛роЪро┐роХроорпН/ро╡родрпИ</button>
<button id="btn-cyclic" class="mode-btn">роПроХ роироЯрпНроЪродрпНродро┐ро░/ро░ро╛роЪро┐</button>
<button id="btn-range2" class="mode-btn">роОродро┐ро░рпН роироЯрпНроЪродрпНродро┐ро░роорпН</button>

</div>


<div id="current"></div>
<div id="currentSplits"></div>
<div id="dasatree"></div>
<div id="padasplit"></div>

<!-- === BEGIN SCRIPT BLOCKS (combine both logics!) === -->
<script>
/* --- API powered place autocomplete and astrologic fetcher from your first file --- */
const LOCATIONIQ_TOKEN = 'pk.c1e392aaa38cf30cc350555c040477b5';
const FREE_ASTRO_API_KEY = 'PZVUMczZA7ahUT0ImRHbB4tHrB16Cyd69iU54vmK';
// Place autocomplete logic (unchanged) ...
const placeInput = document.getElementById('placeInput');
const suggestionsBox = document.getElementById('suggestions-box');
let selectedLat = null, selectedLon = null;
function debounce(func, delay){let t;return function(...a){clearTimeout(t);t = setTimeout(()=>func.apply(this,a),delay);};}
async function fetchPlaceSuggestions(query) {
if(!query||query.length<3) return [];
try {
const res = await fetch(`https://us1.locationiq.com/v1/autocomplete.php?key=${LOCATIONIQ_TOKEN}&q=${encodeURIComponent(query)}&limit=5&format=json`);
if (!res.ok) throw new Error("LocationIQ API error");
return await res.json();
}catch(e){return [];}
}
placeInput.addEventListener('input', debounce(async () => {
const q = placeInput.value.trim();
if(!q){ suggestionsBox.innerHTML=''; suggestionsBox.style.display='none'; selectedLat=selectedLon=null; return; }
const places = await fetchPlaceSuggestions(q);
if(places.length===0){ suggestionsBox.innerHTML=''; suggestionsBox.style.display='none'; selectedLat=selectedLon=null; return; }
suggestionsBox.innerHTML = '';
places.forEach(place => {
const d = document.createElement('div'); d.textContent = place.display_name;
d.onclick = () => {placeInput.value = place.display_name; selectedLat = parseFloat(place.lat); selectedLon = parseFloat(place.lon); suggestionsBox.style.display='none';};
suggestionsBox.appendChild(d);
});
suggestionsBox.style.display='block';
},250));
document.addEventListener('click', e => { if(e.target!==placeInput && !suggestionsBox.contains(e.target)) suggestionsBox.style.display='none';});

// When API form is submitted, calculate and fill degree boxes in manual form!
let apiDataFetched = false;
document.getElementById('astroForm').addEventListener('submit', async function(e){
  if(apiDataFetched){
    alert("API data already fetched. Please use planet buttons or manual input.");
    return;
  }
  apiDataFetched = true;
e.preventDefault();
if(!selectedLat||!selectedLon){alert('родропро╡рпБроЪрпЖропрпНродрпБ роЗроЯроорпН родрпЖро░ро┐ро╡рпБроЪрпЖропрпНропро╡рпБроорпН!');return;}
const dob = document.getElementById('dob_api').value;
const tob = document.getElementById('tob_api').value;
if(!dob||!tob){alert('родрпЗродро┐/роирпЗро░роорпН рокрпВро░рпНродрпНродро┐ роЪрпЖропрпНропро╡рпБроорпН!');return;}
const [year, month, day] = dob.split('-').map(Number);
const [hours, minutes, seconds] = tob.split(':').map(Number);

const payload = {
year, month, date:day, hours, minutes, seconds,
latitude:selectedLat, longitude:selectedLon, timezone:5.5,
settings: {observation_point:"geocentric", ayanamsha:"lahiri", language:"ta"}
};
try {
const res = await fetch('https://json.freeastrologyapi.com/planets/extended', {
method:'POST',
headers: {"Content-Type":"application/json", "x-api-key":FREE_ASTRO_API_KEY },
body: JSON.stringify(payload)
});
if(!res.ok) throw new Error(`API error ${res.status}`);
const data = await res.json();
if(!data.output){document.getElementById('apiResult').textContent="API response missing planet data."; return;}
// Extract Moon and Ascendant (Lagna) degree/min/sec
function decToDMS(dec){
const deg = Math.floor(dec);
const minFloat = (dec-deg)*60;
const min = Math.floor(minFloat);
const sec = Math.round((minFloat-min)*60);
return { deg, min, sec };
}





// 2. Build & populate the table:
const planets = data.output; // e.g., { Moon: {...}, Sun: {...}, ... }
const tableBody = document.querySelector('#planetsDmsTable tbody');
tableBody.innerHTML = ''; // clear any existing rows

// Save planets globally for later redraw
window.savedPlanetsForChart = planets;

// Place them now
placePlanetsOnChart(window.savedPlanetsForChart);

// Ensure consistent ordering:
const planetOrder = ['Ascendant','Sun','Moon','Mercury','Venus','Mars','Jupiter','Saturn','Rahu','Ketu'];

// Rasi list in Tamil
const rasiList = [
  "роорпЗро╖роорпН","ро░ро┐ро╖рокроорпН","рооро┐родрпБройроорпН","роХроЯроХроорпН","роЪро┐роорпНроороорпН","роХройрпНройро┐",
  "родрпБро▓ро╛роорпН","ро╡ро┐ро░рпБроЪрпНроЪро┐роХроорпН","родройрпБроЪрпБ","роороХро░роорпН","роХрпБроорпНрокроорпН","роорпАройроорпН"
];

// Rasi owners
const rasiOwners = {
  "роорпЗро╖роорпН":"роЪрпЖро╡рпНро╡ро╛ропрпН", "ро░ро┐ро╖рокроорпН":"роЪрпБроХрпНро░ройрпН", "рооро┐родрпБройроорпН":"рокрпБродройрпН", "роХроЯроХроорпН":"роЪроирпНродро┐ро░ройрпН",
  "роЪро┐роорпНроороорпН":"роЪрпВро░ро┐ропройрпН", "роХройрпНройро┐":"рокрпБродройрпН", "родрпБро▓ро╛роорпН":"роЪрпБроХрпНро░ройрпН", "ро╡ро┐ро░рпБроЪрпНроЪро┐роХроорпН":"роЪрпЖро╡рпНро╡ро╛ропрпН",
  "родройрпБроЪрпБ":"роХрпБро░рпБ", "роороХро░роорпН":"роЪройро┐", "роХрпБроорпНрокроорпН":"роЪройро┐", "роорпАройроорпН":"роХрпБро░рпБ"
};

planetOrder.forEach(key => {
  if (planets[key] && typeof planets[key].fullDegree === 'number') {
    const { deg, min, sec } = decToDMS(planets[key].fullDegree);

    // Nakshatra & Pada
    const totalDeg = planets[key].fullDegree % 360;
    const nakLen = 13 + 20 / 60;
    const nakIdx = Math.floor(totalDeg / nakLen);
    const nakName = (typeof NAKS !== "undefined" && NAKS[nakIdx]) ? NAKS[nakIdx].name : "-";
    const pada = Math.floor((totalDeg % nakLen) / (nakLen / 4)) + 1;

    // Rasi and Rasi Owner
    const rasiIndex = Math.floor(totalDeg / 30);
    const rasiName = rasiList[rasiIndex] || "-";
    const rasiOwner = rasiOwners[rasiName] || "-";

    // Nakshatra Owner
    const nakOwner = (typeof NAKS !== "undefined" && NAKS[nakIdx]) ? NAKS[nakIdx].lord : "-";

    const row = document.createElement('tr');
    row.innerHTML = `
      <td style="border:1px solid #ccc; padding:8px;">${key}</td>
      <td style="border:1px solid #ccc; padding:8px;">${deg}┬░ ${min}' ${sec}"</td>
      <td style="border:1px solid #ccc; padding:8px;">${nakName} - рокро╛родроорпН ${pada}</td>
      <td style="border:1px solid #ccc; padding:8px;">${rasiName}</td>
      <td style="border:1px solid #ccc; padding:8px;">${rasiOwner}</td>
      <td style="border:1px solid #ccc; padding:8px;">${nakOwner}</td>
    `;
    tableBody.appendChild(row);
  }
});// 1. Define planet codes:
const planetCodes = {
Ascendant:"ро▓",Sun: "роЪрпВ", Moon: "роЪроирпН", Mercury: "рокрпБ", Venus: "роЪрпБ",
Mars: "роЪрпЖ", Jupiter: "роХрпБ", Saturn: "роЪ", Rahu: "ро░ро╛", Ketu: "роХрпЗ"
};

// 2. Helper: get global pada from decimal degree (1тАУ108):
function getGlobalPada(decDeg) {
const totalDegrees = decDeg % 360;
const padaSizeDeg = 360 / 108; // 3┬░20' = 3.3333┬░
return Math.floor(totalDegrees / padaSizeDeg) + 1;
}

// 3. Place abbreviations into the grid:
Object.entries(planets).forEach(([key, obj]) => {
if (obj.fullDegree != null) {
const idx = getGlobalPada(obj.fullDegree);
const cell = padaDomList[idx];
if (cell) {
// Remove any existing label for this planet:
const existing = cell.querySelector(`.planet-${key}`);
if (existing) existing.remove();
// Append a <span> with two-letter code:
const span = document.createElement("span");
span.textContent = planetCodes[key] || key.slice(0,2);
span.className = `planet-${key}`;
span.style.cssText = "font-size:0.9em; margin-left:4px; color:#d22;";
cell.appendChild(span);
}
}
});



// Extract and fill "Moon" and "Ascendant" fields:
if(data.output.Moon && data.output.Ascendant){
const moonDMS = decToDMS(data.output.Moon.fullDegree);
document.getElementById('moon_deg').value = moonDMS.deg;
document.getElementById('moon_min').value = moonDMS.min;
document.getElementById('moon_sec').value = moonDMS.sec;
const ascDMS = decToDMS(data.output.Ascendant.fullDegree);
document.getElementById('lagna_deg').value = ascDMS.deg;
document.getElementById('lagna_min').value = ascDMS.min;
document.getElementById('lagna_sec').value = ascDMS.sec;
// Optionally, set the dob in manual form to dob_api for clarity
document.getElementById('dob').value = document.getElementById('dob_api').value;
}

// === Store all planets' degrees globally ===
window.planetDegrees = {};
Object.keys(data.output).forEach(key => {
  if (typeof data.output[key].fullDegree === 'number') {
    window.planetDegrees[key] = data.output[key].fullDegree;
  }
});

function placePlanetsOnChart(planets) {
  if (!planets) return;

  // ЁЯФ╣ Clear all previous planet labels
  padaDomList.forEach(cell => {
    [...cell.querySelectorAll("[class^='planet-']")].forEach(el => el.remove());
  });

  const planetCodes = {
    Ascendant:"ро▓", Sun: "роЪрпВ", Moon: "роЪроирпН", Mercury: "рокрпБ", Venus: "роЪрпБ",
    Mars: "роЪрпЖ", Jupiter: "роХрпБ", Saturn: "роЪ", Rahu: "ро░ро╛", Ketu: "роХрпЗ"
  };

  function getGlobalPada(decDeg) {
    const totalDegrees = decDeg % 360;
    const padaSizeDeg = 360 / 108;
    return Math.floor(totalDegrees / padaSizeDeg) + 1;
  }

  Object.entries(planets).forEach(([key, obj]) => {
    if (obj.fullDegree != null) {
      const idx = getGlobalPada(obj.fullDegree);
      const cell = padaDomList[idx];
      if (cell) {
        const span = document.createElement("span");
        span.textContent = planetCodes[key] || key.slice(0,2);
        span.className = `planet-${key}`;
        span.style.cssText = "font-size:0.9em; margin-left:4px; color:#d22;";
        cell.appendChild(span);
      }
    }
  });
}


// === Create planet buttons above chart ===
(function(){
  let existing = document.getElementById('planetButtons');
  if(existing) existing.remove();
  const btnContainer = document.createElement('div');
  btnContainer.id = 'planetButtons';
  btnContainer.style.margin = "12px 0";
  btnContainer.style.textAlign = "center";
  Object.keys(window.planetDegrees).forEach(planet => {
    const btn = document.createElement('button');
    btn.textContent = planet;
    btn.style.margin = "4px";
    btn.style.padding = "6px 12px";
    btn.style.border = "1px solid #333";
    btn.style.borderRadius = "5px";
    btn.style.cursor = "pointer";
    btn.onclick = () => showDasaForPlanet(planet);
    btnContainer.appendChild(btn);
  });
  // Insert above chart
  const chartEl = document.getElementById('rasiChart');
  if(chartEl && chartEl.parentNode){
    chartEl.parentNode.insertBefore(btnContainer, chartEl);
  }
})();

document.getElementById('apiResult').textContent = "API planet data рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ!\nроЪроирпНродро┐ро░ройрпН/ро▓роХрпНроХро┐ройроорпН auto-filled.";
}catch(e){
document.getElementById('apiResult').textContent='Error: '+e.message;
}
});

/* --- Now paste the rest of your dasa/pada/tree/chart code from your second file --- */
/* All your JavaScript: chart grid, drawChartGrid, run(), dasa logic, highlighting, upload photo, etc. */
/* ... ... (Due to space, please copy your full JavaScript logic as in your second file here) ... */

// For brevity, not all logic pasted here, but layout and integration is correct!
// If you require the **full combined script block**, I can output it as a file for you.
let mode = "current"; // "cyclic", "current", "range"
let padaDomList = [];
let vimData, vimCurrentPath;
let openState = { dasa:null, puthi:null, anthara:null };

// Button logic
document.addEventListener('DOMContentLoaded', function() {
document.getElementById("btn-cyclic").onclick = ()=>{
mode="cyclic"; setActiveModeBtn('btn-cyclic'); drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
} clearAllHighlights();
};
document.getElementById("btn-current").onclick = ()=>{
mode="current"; setActiveModeBtn('btn-current'); drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
} renderAll();
};
document.getElementById("btn-range").onclick = ()=>{
mode="range"; setActiveModeBtn('btn-range'); drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
} clearAllHighlights();
};

document.getElementById("btn-range2").onclick = ()=>{
mode="range2"; setActiveModeBtn('btn-range2'); drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
} clearAllHighlights();
};

function setActiveModeBtn(activeId) {
document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active-mode'));
document.getElementById(activeId)?.classList.add('active-mode');
}
window.setActiveModeBtn = setActiveModeBtn;
});

const rasiData = [
{ name: "роорпЗро╖роорпН", code: "r01", padas: ["роЕро╕рпНро╡ро┐ройро┐ - рокро╛родроорпН 1", "роЕро╕рпНро╡ро┐ройро┐ - рокро╛родроорпН 2", "роЕро╕рпНро╡ро┐ройро┐ - рокро╛родроорпН 3", "роЕро╕рпНро╡ро┐ройро┐ - рокро╛родроорпН 4", "рокро░рогро┐ - рокро╛родроорпН 1", "рокро░рогро┐ - рокро╛родроорпН 2", "рокро░рогро┐ - рокро╛родроорпН 3", "рокро░рогро┐ - рокро╛родроорпН 4", "роХро┐ро░рпБродрпНродро┐роХрпИ - рокро╛родроорпН 1"] },
{ name: "ро░ро┐ро╖рокроорпН", code: "r02", padas: ["роХро┐ро░рпБродрпНродро┐роХрпИ - рокро╛родроорпН 2", "роХро┐ро░рпБродрпНродро┐роХрпИ - рокро╛родроорпН 3", "роХро┐ро░рпБродрпНродро┐роХрпИ - рокро╛родроорпН 4", "ро░рпЛро╣ро┐рогро┐ - рокро╛родроорпН 1", "ро░рпЛро╣ро┐рогро┐ - рокро╛родроорпН 2", "ро░рпЛро╣ро┐рогро┐ - рокро╛родроорпН 3", "ро░рпЛро╣ро┐рогро┐ - рокро╛родроорпН 4", "рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН - рокро╛родроорпН 1", "рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН - рокро╛родроорпН 2"] },
{ name: "рооро┐родрпБройроорпН", code: "r03", padas: ["рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН - рокро╛родроорпН 3", "рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН - рокро╛родроорпН 4", "родро┐ро░рпБро╡ро╛родро┐ро░рпИ - рокро╛родроорпН 1", "родро┐ро░рпБро╡ро╛родро┐ро░рпИ - рокро╛родроорпН 2", "родро┐ро░рпБро╡ро╛родро┐ро░рпИ - рокро╛родроорпН 3", "родро┐ро░рпБро╡ро╛родро┐ро░рпИ - рокро╛родроорпН 4", "рокрпБройро░рпНрокрпВроЪроорпН - рокро╛родроорпН 1", "рокрпБройро░рпНрокрпВроЪроорпН - рокро╛родроорпН 2", "рокрпБройро░рпНрокрпВроЪроорпН - рокро╛родроорпН 3"] },
{ name: "роХроЯроХроорпН", code: "r04", padas: ["рокрпБройро░рпНрокрпВроЪроорпН - рокро╛родроорпН 4", "рокрпВроЪроорпН - рокро╛родроорпН 1", "рокрпВроЪроорпН - рокро╛родроорпН 2", "рокрпВроЪроорпН - рокро╛родроорпН 3", "рокрпВроЪроорпН - рокро╛родроорпН 4", "роЖропро┐ро▓рпНропроорпН - рокро╛родроорпН 1", "роЖропро┐ро▓рпНропроорпН - рокро╛родроорпН 2", "роЖропро┐ро▓рпНропроорпН - рокро╛родроорпН 3", "роЖропро┐ро▓рпНропроорпН - рокро╛родроорпН 4"] },
{ name: "роЪро┐роорпНроороорпН", code: "r05", padas: ["роороХроорпН - рокро╛родроорпН 1", "роороХроорпН - рокро╛родроорпН 2", "роороХроорпН - рокро╛родроорпН 3", "роороХроорпН - рокро╛родроорпН 4", "рокрпВро░роорпН - рокро╛родроорпН 1", "рокрпВро░роорпН - рокро╛родроорпН 2", "рокрпВро░роорпН - рокро╛родроорпН 3", "рокрпВро░роорпН - рокро╛родроорпН 4", "роЙродрпНродро┐ро░роорпН - рокро╛родроорпН 1"] },
{ name: "роХройрпНройро┐", code: "r06", padas: ["роЙродрпНродро┐ро░роорпН - рокро╛родроорпН 2", "роЙродрпНродро┐ро░роорпН - рокро╛родроорпН 3", "роЙродрпНродро┐ро░роорпН - рокро╛родроорпН 4", "ро╣ро╕рпНродроорпН - рокро╛родроорпН 1", "ро╣ро╕рпНродроорпН - рокро╛родроорпН 2", "ро╣ро╕рпНродроорпН - рокро╛родроорпН 3", "ро╣ро╕рпНродроорпН - рокро╛родроорпН 4", "роЪро┐родрпНродро┐ро░рпИ - рокро╛родроорпН 1", "роЪро┐родрпНродро┐ро░рпИ - рокро╛родроорпН 2"] },
{ name: "родрпБро▓ро╛роорпН", code: "r07", padas: ["роЪро┐родрпНродро┐ро░рпИ - рокро╛родроорпН 3", "роЪро┐родрпНродро┐ро░рпИ - рокро╛родроорпН 4", "роЪрпБро╡ро╛родро┐ - рокро╛родроорпН 1", "роЪрпБро╡ро╛родро┐ - рокро╛родроорпН 2", "роЪрпБро╡ро╛родро┐ - рокро╛родроорпН 3", "роЪрпБро╡ро╛родро┐ - рокро╛родроорпН 4", "ро╡ро┐роЪро╛роХроорпН - рокро╛родроорпН 1", "ро╡ро┐роЪро╛роХроорпН - рокро╛родроорпН 2", "ро╡ро┐роЪро╛роХроорпН - рокро╛родроорпН 3"] },
{ name: "ро╡ро┐ро░рпБроЪрпНроЪро┐роХроорпН", code: "r08", padas: ["ро╡ро┐роЪро╛роХроорпН - рокро╛родроорпН 4", "роЕройрпБро╖роорпН - рокро╛родроорпН 1", "роЕройрпБро╖роорпН - рокро╛родроорпН 2", "роЕройрпБро╖роорпН - рокро╛родроорпН 3", "роЕройрпБро╖роорпН - рокро╛родроорпН 4", "роХрпЗроЯрпНроЯрпИ - рокро╛родроорпН 1", "роХрпЗроЯрпНроЯрпИ - рокро╛родроорпН 2", "роХрпЗроЯрпНроЯрпИ - рокро╛родроорпН 3", "роХрпЗроЯрпНроЯрпИ - рокро╛родроорпН 4"] },
{ name: "родройрпБроЪрпБ", code: "r09", padas: ["роорпВро▓роорпН - рокро╛родроорпН 1", "роорпВро▓роорпН - рокро╛родроорпН 2", "роорпВро▓роорпН - рокро╛родроорпН 3", "роорпВро▓роорпН - рокро╛родроорпН 4", "рокрпВро░ро╛роЯроорпН - рокро╛родроорпН 1", "рокрпВро░ро╛роЯроорпН - рокро╛родроорпН 2", "рокрпВро░ро╛роЯроорпН - рокро╛родроорпН 3", "рокрпВро░ро╛роЯроорпН - рокро╛родроорпН 4", "роЙродрпНродро┐ро░ро╛роЯроорпН - рокро╛родроорпН 1"] },
{ name: "роороХро░роорпН", code: "r10", padas: ["роЙродрпНродро┐ро░ро╛роЯроорпН - рокро╛родроорпН 2", "роЙродрпНродро┐ро░ро╛роЯроорпН - рокро╛родроорпН 3", "роЙродрпНродро┐ро░ро╛роЯроорпН - рокро╛родроорпН 4", "родро┐ро░рпБро╡рпЛрогроорпН - рокро╛родроорпН 1", "родро┐ро░рпБро╡рпЛрогроорпН - рокро╛родроорпН 2", "родро┐ро░рпБро╡рпЛрогроорпН - рокро╛родроорпН 3", "родро┐ро░рпБро╡рпЛрогроорпН - рокро╛родроорпН 4", "роЕро╡ро┐роЯрпНроЯроорпН - рокро╛родроорпН 1", "роЕро╡ро┐роЯрпНроЯроорпН - рокро╛родроорпН 2"] },
{ name: "роХрпБроорпНрокроорпН", code: "r11", padas: ["роЕро╡ро┐роЯрпНроЯроорпН - рокро╛родроорпН 3", "роЕро╡ро┐роЯрпНроЯроорпН - рокро╛родроорпН 4", "роЪродропроорпН - рокро╛родроорпН 1", "роЪродропроорпН - рокро╛родроорпН 2", "роЪродропроорпН - рокро╛родроорпН 3", "роЪродропроорпН - рокро╛родроорпН 4", "рокрпВро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 1", "рокрпВро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 2", "рокрпВро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 3"] },
{ name: "роорпАройроорпН", code: "r12", padas: ["рокрпВро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 4", "роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 1", "роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 2", "роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 3", "роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐ - рокро╛родроорпН 4", "ро░рпЗро╡родро┐ - рокро╛родроорпН 1", "ро░рпЗро╡родро┐ - рокро╛родроорпН 2", "ро░рпЗро╡родро┐ - рокро╛родроорпН 3", "ро░рпЗро╡родро┐ - рокро╛родроорпН 4"] }
];
const rasisToReverse = ["ро░ро┐ро╖рокроорпН", "родрпБро▓ро╛роорпН", "родройрпБроЪрпБ", "роороХро░роорпН", "роХрпБроорпНрокроорпН", "роорпАройроорпН"];

// Start global pada index from 1 for rasi 1 (роорпЗро╖роорпН)
let globalPadaCounter = 1;

rasiData.forEach(rasi => {
const isReversed = rasisToReverse.includes(rasi.name);
if (isReversed) {
// Reverse the padas array itself
rasi.padas.reverse();
}

// Assign global index mapping within this rasi
// For reversed rasis, indices go from higher to lower
rasi.globalPadaIndexes = [];
for (let i = 0; i < 9; i++) {
if (isReversed) {
rasi.globalPadaIndexes.push(globalPadaCounter + 8 - i);
} else {
rasi.globalPadaIndexes.push(globalPadaCounter + i);
}
}

globalPadaCounter += 9;
});


function drawChartGrid() {
document.getElementById('rasiChart').innerHTML = '';
padaDomList = [];
let padaCounter = 1;

rasiData.forEach((rasi, ri) => {
const box = document.createElement("div");
box.className = `box ${rasi.code}`;
box.setAttribute('data-rasi-idx', ri + 1);
const title = document.createElement("div");
title.className = "rasi-name";
title.textContent = rasi.name;
box.appendChild(title);

for (let j = 0; j < 9; j++) {
const line = document.createElement("div");
line.className = "line";

// Display number is always 1 to 9 top to bottom
// But pada label and global index respects reversal:
line.textContent = `${rasi.padas[j] ? rasi.padas[j] : "-"}`;

// Use the calculated global index mapping:
line.setAttribute("data-pada-index", rasi.globalPadaIndexes[j]);

padaDomList[rasi.globalPadaIndexes[j]] = line; // map global pada to Dom line

box.appendChild(line);
}
document.getElementById('rasiChart').appendChild(box);
});

for(let i=1; i<=108; i++) {
if(!padaDomList[i]) continue;
padaDomList[i].onclick = null;
padaDomList[i].addEventListener("click", function(evt) {
if(mode==="cyclic") {
highlightPadaCyclic(i);
} else if(mode==="range") {
highlightPadaRange(i);
} else if(mode==="range1") {
highlightPadaRange1(i);
} else if(mode==="range2") {
highlightPadaRange2(i);
}
});
}
if(mode==="current") showCurrentDasaPadaHighlight();
}

function clearCyclicHighlights() {
document.querySelectorAll('.line.highlight-pada-interactive').forEach(e=>e.classList.remove('highlight-pada-interactive'));
document.querySelectorAll('.box.active-rasi-cyclic').forEach(e=>e.classList.remove('active-rasi-cyclic'));
}
function clearCurrentDasaHighlights() {
document.querySelectorAll('.line.highlight-pada-dasa').forEach(e=>e.classList.remove('highlight-pada-dasa'));
document.querySelectorAll('.line.highlight-pada-puthi').forEach(e=>e.classList.remove('highlight-pada-puthi'));
document.querySelectorAll('.line.highlight-pada-anthara').forEach(e=>e.classList.remove('highlight-pada-anthara'));
document.querySelectorAll('.box.active-rasi-current').forEach(e=>e.classList.remove('active-rasi-current'));
document.querySelectorAll('.tree-active').forEach(e=>e.classList.remove('tree-active'));
}
function clearRangeHighlights() {
document.querySelectorAll('.line.highlight-pada-orange').forEach(e=>e.classList.remove('highlight-pada-orange'));
document.querySelectorAll('.line.highlight-pada-blue').forEach(e=>e.classList.remove('highlight-pada-blue'));
document.querySelectorAll('.clicked-pada-special').forEach(e=>e.classList.remove('clicked-pada-special'));
}
function clearRange1Highlights() {
document.querySelectorAll('.line.highlight-pada-interactive').forEach(e=>e.classList.remove('highlight-pada-interactive'));
}
function clearRange2Highlights() {
document.querySelectorAll('.line.highlight-pada-interactive').forEach(e=>e.classList.remove('highlight-pada-interactive'));
}
function clearRange3Highlights() {
document.querySelectorAll('.highlight-pada-1').forEach(e=>e.classList.remove('highlight-pada-1'));
document.querySelectorAll('.highlight-pada-2').forEach(e=>e.classList.remove('highlight-pada-2'));
document.querySelectorAll('.highlight-pada-3').forEach(e=>e.classList.remove('highlight-pada-3'));
document.querySelectorAll('.highlight-pada-4').forEach(e=>e.classList.remove('highlight-pada-4'));
document.querySelectorAll('.highlight-pada-5').forEach(e=>e.classList.remove('highlight-pada-5'));
document.querySelectorAll('.highlight-pada-6').forEach(e=>e.classList.remove('highlight-pada-6'));
document.querySelectorAll('.highlight-pada-7').forEach(e=>e.classList.remove('highlight-pada-7'));
document.querySelectorAll('.highlight-pada-8').forEach(e=>e.classList.remove('highlight-pada-8'));
document.querySelectorAll('.highlight-pada-9').forEach(e=>e.classList.remove('highlight-pada-9'));
document.querySelectorAll('.highlight-pada-10').forEach(e=>e.classList.remove('highlight-pada-10'));
document.querySelectorAll('.highlight-pada-11').forEach(e=>e.classList.remove('highlight-pada-11'));
document.querySelectorAll('.highlight-pada-12').forEach(e=>e.classList.remove('highlight-pada-12'));
document.querySelectorAll('.clicked-pada-1').forEach(e=>e.classList.remove('clicked-pada-1'));
document.querySelectorAll('.box.active-rasi-cyclic-range3').forEach(e=>e.classList.remove('active-rasi-cyclic-range3'));
}

function clearAllHighlights() {
clearCyclicHighlights(); clearCurrentDasaHighlights(); clearRangeHighlights(); clearRange1Highlights();clearRange2Highlights();clearRange3Highlights();
['highlight-dasa','highlight-puthi','highlight-anth'].forEach(cls =>
document.querySelectorAll(`.line.${cls}`).forEach(e => e.classList.remove(cls))
);
document.querySelectorAll('.box.active-rasi').forEach(e=>e.classList.remove('active-rasi'));
}

// ---- Mode 1: Cyclic Pada 37/73 ----
function highlightPadaCyclic(padaIndex) {
clearAllHighlights();showCurrentDasaPadaHighlight();
[0,36,72].forEach(offset=>{
let idx=((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-interactive');
});
}
// ---- Mode 2: Chart Current Dasa Pada (Green) ----
function showCurrentDasaPadaHighlight(dpi) {
clearAllHighlights();
if(!vimData || !vimCurrentPath) return;
let now = new Date();
if (document.getElementById("caldate").value) now = new Date(document.getElementById("caldate").value);
let md = vimData[vimCurrentPath.dasa], pt = md && md.puthis[vimCurrentPath.puthi], at = pt && pt.antharas[vimCurrentPath.anth];
let mdPada = getCurrentPada(md, now), ptPada = getCurrentPada(pt, now), atPada = getCurrentPada(at, now);
let idxD = (mdPada.pada>0) ? findPadaIndexByLabel(mdPada.nak, mdPada.pada) : -1;
let idxP = (ptPada.pada>0) ? findPadaIndexByLabel(ptPada.nak, ptPada.pada) : -1;
let idxA = (atPada.pada>0) ? findPadaIndexByLabel(atPada.nak, atPada.pada) : -1;
if(dpi){ if(dpi.dasa!=-1 && pagiCheck(idxD)) padaDomList[idxD].classList.add('highlight-pada-dasa');
if(dpi.puthi!=-1 && pagiCheck(idxP)) padaDomList[idxP].classList.add('highlight-pada-puthi');
if(dpi.anthara!=-1 && pagiCheck(idxA)) padaDomList[idxA].classList.add('highlight-pada-anthara');
} else {
if(pagiCheck(idxD)) padaDomList[idxD].classList.add('highlight-pada-dasa');
if(pagiCheck(idxP)) padaDomList[idxP].classList.add('highlight-pada-puthi');
if(pagiCheck(idxA)) padaDomList[idxA].classList.add('highlight-pada-anthara');
}
}
function pagiCheck(idx){ return idx>0 && idx<=108;}
function findPadaIndexByLabel(nakName, padaNum) {
  nakName = nakName.trim();
  padaNum = Number(padaNum);
  for(let i=1; i<=108; i++) {
    let label = padaDomList[i].textContent.replace(/^[0-9]+\\.\\s*/, '').trim();
    if(label.includes(nakName) && label.includes('рокро╛родроорпН ' + padaNum)) return i;
  }
  return -1;
}

// ---- Mode 3: Range Highlight ----
function highlightPadaRange(padaIndex) {
clearAllHighlights();showCurrentDasaPadaHighlight();
if(padaDomList[padaIndex]) padaDomList[padaIndex].classList.add('clicked-pada-special');
for(let offset=84; offset<=87; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-orange');
}
for(let offset=24; offset<=27; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-blue');
}
}
// ---- Mode 4: range1 highlight  ----
function highlightPadaRange1(padaIndex) {
clearAllHighlights();showCurrentDasaPadaHighlight();
[0,9,18,27,36,45,54,63,72,81,90,99].forEach(offset=>{
let idx=((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-interactive');
});

}
// ---- Mode 4: range2 highlight  ----
function highlightPadaRange2(padaIndex) {
clearAllHighlights();showCurrentDasaPadaHighlight();
[0,54].forEach(offset=>{
let idx=((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-interactive');
});
let rasiIdx=Math.ceil(padaIndex/9); // 1..12
document.querySelector(`.box[data-rasi-idx="${rasiIdx}"]`)?.classList.add('active-rasi-cyclic');
let rasi7=((rasiIdx+6-1)%12)+1;
document.querySelector(`.box[data-rasi-idx="${rasi7}"]`)?.classList.add('active-rasi-cyclic');

}
// ---- Mode 3: Range3 Highlight ----
function highlightPadaRange3(padaIndex) {
clearAllHighlights();showCurrentDasaPadaHighlight();
if(padaDomList[padaIndex]) padaDomList[padaIndex].classList.add('clicked-pada-1');
for(let offset=1; offset<=8; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-1');
}
for(let offset=9; offset<=17; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-2');
}
for(let offset=18; offset<=26; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-3');
}
for(let offset=27; offset<=35; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-4');
}
for(let offset=36; offset<=44; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-5');
}
for(let offset=45; offset<=53; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-6');
}
for(let offset=54; offset<=62; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-7');
}
for(let offset=63; offset<=71; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-8');
}
for(let offset=72; offset<=80; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-9');
}
for(let offset=81; offset<=89; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-10');
}
for(let offset=90; offset<=98; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-11');
}
for(let offset=99; offset<=107; offset++) {
let idx = ((padaIndex-1+offset)%108)+1;
if(padaDomList[idx]) padaDomList[idx].classList.add('highlight-pada-12');
}
}


function getLagnaPadaIndex(degree) {
const totalSeconds = degree * 3600; // convert to arc seconds
const padaSize = 200; // each pada is 3┬░20' = 200'
const padaIndex = Math.floor(totalSeconds / (60 * padaSize)) + 1;
return padaIndex; // from 1 to 108
}
function getMoonPadaIndex(moon_deg, moon_min, moon_sec) {
// Convert to decimal degrees
let degree = Number(moon_deg) + Number(moon_min)/60 + Number(moon_sec)/3600;
// Each nakshatra is 13┬░20' (13.3333...), each pada is 3┬░20' (3.3333...)
const NAKSHATRA_DEGREES = 13 + 20/60;
const NAKSHATRA_PADA_DEGREES = NAKSHATRA_DEGREES / 4;
let nakshatra = Math.floor(degree / NAKSHATRA_DEGREES);
let pada = Math.floor((degree % NAKSHATRA_DEGREES) / NAKSHATRA_PADA_DEGREES) + 1; // 1..4
// Global pada index (1-based)
let globalPada = nakshatra * 4 + (pada - 1) + 1;
return globalPada; // 1 to 108
}

function placeMoonSymbolToPada(globalPada) {
// Assumes padaDomList is globally available as in your code
// Optional: first clear all previous moon symbols:
document.querySelectorAll('.moon-pada-marker').forEach(e => e.remove());

let padaDiv = padaDomList[globalPada];
if (padaDiv) {
padaDiv.innerHTML += `<span class="moon-pada-marker" style="font-size:1.3em; margin-left:5px;">ЁЯМЩ</span>`;
}
}


// ---------- DASA TREE RENDER with Date & Neat Indent, and CLICK-TO-HIGHLIGHT ----------
function highlightPada(padaLabel, cls) {
document.querySelectorAll(`.line.${cls}`).forEach(e => e.classList.remove(cls));
for(let i=1; i<=108; i++) {
if(!padaDomList[i]) continue;
let plabel = padaDomList[i].textContent.replace(/^[0-9]+\.\s*/, '').trim();
if(plabel === padaLabel.trim()) {
padaDomList[i].classList.add(cls);
}
}
}
function bar(percent) {
  return `<div style="position:relative;height:8px;background:#e9e9f2;border-radius:4px;overflow:hidden;width:65%;margin:5px 0 0 0;">
      <div style="background:#4fe37a;height:100%;border-radius:4px;width:${percent}%;"></div>
      <span style="position:absolute;right:6px;top:-2px;font-size:0.93em;color:#23985c;">${percent}%</span>
    </div>`;
}





// CLICK on TREE = Only highlight pada for that period (NO rasis), nothing else highlighted
window.treeClickDasa = function(di){
clearAllHighlights();
let md = vimData[di];
let mdPada = getCurrentPada(md, new Date());
if(mdPada.pada>0) {
let idxD = findPadaIndexByLabel(mdPada.nak, mdPada.pada);
if(pagiCheck(idxD)) padaDomList[idxD].classList.add('highlight-pada-dasa');
}
}
window.treeClickPuthi = function(di, pi){
clearAllHighlights();
let pt = vimData[di].puthis[pi];
let ptPada = getCurrentPada(pt, new Date());
if(ptPada.pada>0) {
let idxP = findPadaIndexByLabel(ptPada.nak, ptPada.pada);
if(pagiCheck(idxP)) padaDomList[idxP].classList.add('highlight-pada-puthi');
}
}
window.treeClickAnthara = function(di,pi,ai){
clearAllHighlights();
let at = vimData[di].puthis[pi].antharas[ai];
let atPada = getCurrentPada(at, new Date());
if(atPada.pada>0) {
let idxA = findPadaIndexByLabel(atPada.nak, atPada.pada);
if(pagiCheck(idxA)) padaDomList[idxA].classList.add('highlight-pada-anthara');
}
}

window.expandDasa = function(idx) {
openState.dasa = (openState.dasa === idx ? null : idx);
openState.puthi = null; openState.anthara = null; renderAll();
};
window.expandPuthi = function(idx) {
openState.puthi = (openState.puthi === idx ? null : idx);
openState.anthara = null; renderAll();
};

function getDasaPercentage(dasa, now) {
  if (!dasa || !dasa.start || !dasa.end) return 0;
  const total = dasa.end - dasa.start;
  const elapsed = now - dasa.start;
  return Math.round(Math.min(Math.max(elapsed / total, 0), 1) * 100);
}
function renderTree(arr, curr, openState) {
  function dasaUl() {
    let html = "<ul class='tree-ul'>";
    arr.forEach((md, mi) => {
      let cl = "";
      if (curr.dasa === mi) cl += " tree-active";
      html += `<li class="tree-li${cl}">`
        + `<button class="expand-btn${openState.dasa === mi ? " expanded" : ""}" `
        + `onclick="expandDasa(${mi});event.stopPropagation();">${openState.dasa === mi ? "тЦ╛" : "тЦ╕"}</button>`
        + `<span class='tree-highlight-dasa' onclick="treeClickDasa(${mi});event.stopPropagation();">`
        + `${md.lord} (${md.nak})</span>`
        + `<span class="tree-period">${formatDate(md.start)} - ${formatDate(md.end)}</span>`;
      if (openState.dasa === mi) html += puthiUl(md, mi);
      html += "</li>";
    });
    html += "</ul>";
    return html;
  }

  function puthiUl(md, mdi) {
    let html = "<ul class='tree-ul'>";
    md.puthis.forEach((pt, pi) => {
      let cl = "";
      if (curr.dasa === mdi && curr.puthi === pi) cl += " tree-active";
      html += `<li class="tree-li${cl}">`
        + `<button class="expand-btn${openState.puthi === pi ? " expanded" : ""}" `
        + `onclick="expandPuthi(${pi});event.stopPropagation();">${openState.puthi === pi ? "тЦ╛" : "тЦ╕"}</button>`
        + `<span class='tree-highlight-puthi' onclick="treeClickPuthi(${mdi},${pi});event.stopPropagation();">`
        + `${pt.lord} (${pt.nak})</span>`
        + `<span class="tree-period">${formatDate(pt.start)} - ${formatDate(pt.end)}</span>`;
      if (openState.puthi === pi) html += antharaUl(pt, mdi, pi);
      html += "</li>";
    });
    html += "</ul>";
    return html;
  }

  function antharaUl(pt, mdi, pi) {
    let html = "<ul class='tree-ul'>";
    pt.antharas.forEach((at, ai) => {
      let cl = "";
      if (curr.dasa === mdi && curr.puthi === pi && curr.anth === ai) cl += " tree-active";
      html += `<li class="tree-li${cl}">`
        + `<span class='tree-highlight-anthara' onclick="treeClickAnthara(${mdi},${pi},${ai});event.stopPropagation();">`
        + `${at.lord} (${at.nak})</span>`
        + `<span class="tree-period">${formatDate(at.start)} - ${formatDate(at.end)}</span></li>`;
    });
    html += "</ul>";
    return html;
  }

  document.getElementById('dasatree').innerHTML = dasaUl();
}

function renderSummary(md, mdPada, pt, ptPada, at, atPada) {
  let now = new Date();
  // Use calculation date if chosen
  if (document.getElementById("caldate") && document.getElementById("caldate").value)
    now = new Date(document.getElementById("caldate").value); 

  const dasaPercent = getDasaPercentage(md, now);
  const puthiPercent = getDasaPercentage(pt, now);
  const anthPercent = getDasaPercentage(at, now);

  let html = `<div class="currentbox" style="margin-bottom:24px;text-align:left;">
    <div style="margin-bottom:7px;">
      <span style="color:#17671a;font-weight:bold;">родроЪрпИ</span>: <b>${md ? md.lord:"-"}</b>
      (${mdPada && mdPada.pada ? mdPada.nak : ""} - рокро╛родроорпН ${mdPada && mdPada.pada ? mdPada.pada : '-'})<br/>
      <span class="dates">${mdPada && mdPada.from ? formatDate(mdPada.from) + ' - ' + formatDate(mdPada.to) : ''}</span><br>
      <b>родроЪрпИ роорпБройрпНройрпЗро▒рпНро▒роорпН:</b> ${dasaPercent}%
    </div>
    <div style="margin-bottom:7px;">
      <span style="color:#40be4a;font-weight:bold;">рокрпБроХрпНродро┐</span>: <b>${pt ? pt.lord:"-"}</b>
      (${ptPada && ptPada.pada ? ptPada.nak : ""} - рокро╛родроорпН ${ptPada && ptPada.pada ? ptPada.pada : '-'})<br/>
      <span class="dates">${ptPada && ptPada.from ? formatDate(ptPada.from) + ' - ' + formatDate(ptPada.to) : ''}</span><br>
      <b>рокрпБроХрпНродро┐ роорпБройрпНройрпЗро▒рпНро▒роорпН:</b> ${puthiPercent}%
    </div>
    <div>
      <span style="color:#40be4a;font-weight:bold;">роЕроирпНродро░роорпН</span>: <b>${at ? at.lord:"-"}</b>
      (${atPada && atPada.pada ? atPada.nak : ""} - рокро╛родроорпН ${atPada && atPada.pada ? atPada.pada : '-'})<br/>
      <span class="dates">${atPada && atPada.from ? formatDate(atPada.from) + ' - ' + formatDate(atPada.to) : ''}</span><br>
      <b>роЕроирпНродро░роорпН роорпБройрпНройрпЗро▒рпНро▒роорпН:</b> ${anthPercent}%
    </div>
  </div>`;

  document.getElementById("current").innerHTML = html;
}



function renderPadaSplit(arr, lab) {
document.getElementById("padasplit").innerHTML =
'<div class="padasplit"><b>родроЪрпИ,рокрпБроХрпНродро┐ рокро┐ро░ро┐родрпНродрпБ kattapadam :</b><br>' + lab + arr.map(pd =>
`<div>${pd.nak} - рокро╛родроорпН ${pd.pada}  <span class="dates">${formatDate(pd.start)} - ${formatDate(pd.end)}</span></div>`
).join("") + '</div>';
}

function renderAll(nowParam) {
clearAllHighlights();
let now = nowParam || new Date();
let md = vimData && vimData[vimCurrentPath.dasa], pt = md && md.puthis[vimCurrentPath.puthi], at = pt && pt.antharas[vimCurrentPath.anth];
let mdPada = getCurrentPada(md, now), ptPada = getCurrentPada(pt, now), atPada = getCurrentPada(at, now);
if(mode==="current") showCurrentDasaPadaHighlight();
renderSummary(md, mdPada, pt, ptPada, at, atPada);
renderTree(vimData, vimCurrentPath, openState);

// === New: Show 4-part splits for current dasa, puthi, anthra ===
function buildSplitBox(title, period) {
  if (!period) return "";
  const splits = currentPadaSplit(period);
  return `
    <div style="margin:12px 0; padding:10px; border:1.5px solid #999; border-radius:8px; background:#f9f9f9; text-align:left;">
      <b>${title} - ${period.nak} (${period.lord})</b><br/>
      ${splits.map(s => `${s.nak} - рокро╛родроорпН ${s.pada} : 
        <span class="dates">${formatDate(s.start)} - ${formatDate(s.end)}</span>`).join("<br/>")}
    </div>
  `;
}

document.getElementById("currentSplits").innerHTML =
    buildSplitBox("родроЪрпИ", md) +
    buildSplitBox("рокрпБроХрпНродро┐", pt) +
    buildSplitBox("роЕроирпНродро░роорпН", at);

renderTree(vimData, vimCurrentPath, openState);
let target, lab = "";
if(openState.anthara != null) {
target = vimData[openState.dasa].puthis[openState.puthi].antharas[openState.anthara];
lab = `<u>роЕроирпНродро░роорпН (${target.nak} ${target.lord}):</u>`;
}
else if(openState.puthi != null) {
target = vimData[openState.dasa].puthis[openState.puthi];
lab = `<u>рокрпБроХрпНродро┐ (${target.nak} ${target.lord}):</u>`;
}
else if(openState.dasa != null) {
target = vimData[openState.dasa];
lab = `<u>родроЪрпИ (${target.nak} ${target.lord}):</u>`;
}
else target = null;
let arr = target ? currentPadaSplit(target) : [];
renderPadaSplit(arr, lab);
}

const PLANETS = ["роХрпЗродрпБ","роЪрпБроХрпНро░ройрпН","роЪрпВро░ро┐ропройрпН","роЪроирпНродро┐ро░ройрпН","роЪрпЖро╡рпНро╡ро╛ропрпН","ро░ро╛роХрпБ","роХрпБро░рпБ","роЪройро┐","рокрпБродройрпН"];
const DASA_YEARS = {"роХрпЗродрпБ":7,"роЪрпБроХрпНро░ройрпН":20,"роЪрпВро░ро┐ропройрпН":6,"роЪроирпНродро┐ро░ройрпН":10,"роЪрпЖро╡рпНро╡ро╛ропрпН":7,"ро░ро╛роХрпБ":18,"роХрпБро░рпБ":16,"роЪройро┐":19,"рокрпБродройрпН":17};
const NAKS = [
{name:'роЕро╕рпНро╡ро┐ройро┐',lord:'роХрпЗродрпБ'},
{name:'рокро░рогро┐',lord:'роЪрпБроХрпНро░ройрпН'},
{name:'роХро┐ро░рпБродрпНродро┐роХрпИ',lord:'роЪрпВро░ро┐ропройрпН'},
{name:'ро░рпЛро╣ро┐рогро┐',lord:'роЪроирпНродро┐ро░ройрпН'},
{name:'рооро┐ро░рпБроХроЪрпАро░ро┐роЯроорпН',lord:'роЪрпЖро╡рпНро╡ро╛ропрпН'},
{name:'родро┐ро░рпБро╡ро╛родро┐ро░рпИ',lord:'ро░ро╛роХрпБ'},
{name:'рокрпБройро░рпНрокрпВроЪроорпН',lord:'роХрпБро░рпБ'},
{name:'рокрпВроЪроорпН',lord:'роЪройро┐'},
{name:'роЖропро┐ро▓рпНропроорпН',lord:'рокрпБродройрпН'},
{name:'роороХроорпН',lord:'роХрпЗродрпБ'},
{name:'рокрпВро░роорпН',lord:'роЪрпБроХрпНро░ройрпН'},
{name:'роЙродрпНродро┐ро░роорпН',lord:'роЪрпВро░ро┐ропройрпН'},
{name:'ро╣ро╕рпНродроорпН',lord:'роЪроирпНродро┐ро░ройрпН'},
{name:'роЪро┐родрпНродро┐ро░рпИ',lord:'роЪрпЖро╡рпНро╡ро╛ропрпН'},
{name:'роЪрпБро╡ро╛родро┐',lord:'ро░ро╛роХрпБ'},
{name:'ро╡ро┐роЪро╛роХроорпН',lord:'роХрпБро░рпБ'},
{name:'роЕройрпБро╖роорпН',lord:'роЪройро┐'},
{name:'роХрпЗроЯрпНроЯрпИ',lord:'рокрпБродройрпН'},
{name:'роорпВро▓роорпН',lord:'роХрпЗродрпБ'},
{name:'рокрпВро░ро╛роЯроорпН',lord:'роЪрпБроХрпНро░ройрпН'},
{name:'роЙродрпНродро┐ро░ро╛роЯроорпН',lord:'роЪрпВро░ро┐ропройрпН'},
{name:'родро┐ро░рпБро╡рпЛрогроорпН',lord:'роЪроирпНродро┐ро░ройрпН'},
{name:'роЕро╡ро┐роЯрпНроЯроорпН',lord:'роЪрпЖро╡рпНро╡ро╛ропрпН'},
{name:'роЪродропроорпН',lord:'ро░ро╛роХрпБ'},
{name:'рокрпВро░роЯрпНроЯро╛родро┐',lord:'роХрпБро░рпБ'},
{name:'роЙродрпНродро┐ро░роЯрпНроЯро╛родро┐',lord:'роЪройро┐'},
{name:'ро░рпЗро╡родро┐',lord:'рокрпБродройрпН'}
];
function addYears(date, years) {
let d = new Date(date), y = Math.floor(years), m = (years - y) * 12;
d.setFullYear(d.getFullYear() + y);
d.setMonth(d.getMonth() + Math.floor(m));
d.setDate(d.getDate() + Math.round((m - Math.floor(m)) * 30));
return d;
}
function formatDate(dt) { return dt.toISOString().slice(0,10); }
function cycle9Nakshatras(start) { return Array(9).fill(0).map((_,j) => (start+j)%27); }
function getDasaLordsAndNames(moon) {
const nakLen = 13 + 20/60; // 13┬░20'
const nakIdx = Math.floor(moon / nakLen);
const startLord = NAKS[nakIdx].lord;
const planetOrder = PLANETS;
const startIdx = planetOrder.indexOf(startLord);
const dasaLords = planetOrder.slice(startIdx).concat(planetOrder.slice(0,startIdx));
const dasaNakIdxs = Array(9).fill(0).map((_,j) => (nakIdx + j) % 27);
const dasaNakNames = dasaNakIdxs.map(idx => NAKS[idx].name);
return {dasaLords, dasaNakIdxs, dasaNakNames, nakIdx};
}
function dasaTree(moon, dob, now) {
const nakLen = 13 + 20/60; // 13.333333... deg per nakshatra
const {dasaLords, dasaNakIdxs, dasaNakNames, nakIdx} = getDasaLordsAndNames(moon);
const offsetDeg = moon - nakIdx * nakLen;
let balance = 1 - (offsetDeg / nakLen);
let mdStarts = [], cursor = addYears(dob, -(DASA_YEARS[dasaLords[0]] * (1 - balance)));
for(let i=0; i<9; i++) {
mdStarts[i] = new Date(cursor);
let span = DASA_YEARS[dasaLords[i]];
cursor = addYears(cursor, span);
}
let arr = dasaLords.map((lord,i) => ({
index: i,
lord: lord,
nak: dasaNakNames[i],
nakIdx: dasaNakIdxs[i],
start: mdStarts[i],
end: mdStarts[i+1] || cursor,
current: now >= mdStarts[i] && now < (mdStarts[i+1]||cursor),
puthis: []
}));
arr.forEach((md, mdi) => {
let puthiNakIdxs = cycle9Nakshatras(md.nakIdx);
let puthiLords = puthiNakIdxs.map(idx => NAKS[idx].lord);
let puthiNakNames = puthiNakIdxs.map(idx => NAKS[idx].name);
let duration = (md.end - md.start) / (1000*60*60*24*365.2425);
let antarStarts = [], cursorP = new Date(md.start);
for(let j=0; j<9; j++) {
antarStarts[j] = new Date(cursorP);
let antardur = duration * (DASA_YEARS[puthiLords[j]] / 120);
cursorP = addYears(cursorP, antardur);
}
md.puthis = puthiLords.map((plord,pi) => ({
index: pi,
lord: plord,
nak: puthiNakNames[pi],
nakIdx: puthiNakIdxs[pi],
start: antarStarts[pi],
end: antarStarts[pi+1] || cursorP,
current: now >= antarStarts[pi] && now < (antarStarts[pi+1] || cursorP),
antharas: []
}));
md.puthis.forEach((pt, pk) => {
let anthNakIdxs = cycle9Nakshatras(pt.nakIdx);
let anthLords = anthNakIdxs.map(idx => NAKS[idx].lord);
let anthNakNames = anthNakIdxs.map(idx => NAKS[idx].name);
let dur = (pt.end - pt.start) / (1000*60*60*24*365.2425);
let anthStarts = [], cursorA = new Date(pt.start);
for(let k=0; k<9; k++) {
anthStarts[k] = new Date(cursorA);
let ahDur = dur * (DASA_YEARS[anthLords[k]] / 120);
cursorA = addYears(cursorA, ahDur);
}
pt.antharas = anthLords.map((alord, ai) => ({
index: ai,
lord: alord,
nak: anthNakNames[ai],
nakIdx: anthNakIdxs[ai],
start: anthStarts[ai],
end: anthStarts[ai+1] || cursorA,
current: now >= anthStarts[ai] && now < (anthStarts[ai+1] || cursorA)
}));
});
});
return arr;
}
function currentPadaSplit(period) {
if(!period) return [];
let nakIdx = period.nakIdx;
let cursor = new Date(period.start);
let len = (period.end - period.start) / (1000*60*60*24*365.2425) / 4;
let arr = [];
for(let i=0; i<4; i++) {
let padaEnd = addYears(cursor, len);
arr.push({ nak: NAKS[nakIdx].name, pada: i+1, lord: NAKS[nakIdx].lord, start: new Date(cursor), end: padaEnd });
cursor = padaEnd;
}
return arr;
}
function findCurrentPath(tree) {
for(let i=0; i<tree.length; i++) {
let md = tree[i];
if(md.current) {
let dI = i, pI = -1, aI = -1;
for(let j=0; j<md.puthis.length; j++) {
let pt = md.puthis[j];
if(pt.current) {
pI = j;
for(let k=0; k<pt.antharas.length; k++) {
if(pt.antharas[k].current) { aI = k; }
}
}
}
return { dasa: dI, puthi: pI, anth: aI };
}
}
return { dasa:-1, puthi:-1, anth:-1 };
}
function getCurrentPada(period, now) {
if(!period) return {padaIdx:-1, pada:null, from:null, to:null, nak:null};
let cursor = new Date(period.start);
let len = (period.end - period.start) / (1000*60*60*24*365.2425) / 4;
for(let i=0; i<4; i++) {
let padaEnd = addYears(cursor, len);
if(now >= cursor && now < padaEnd) return {
padaIdx: i,
pada: i + 1,
from: new Date(cursor),
to: new Date(padaEnd),
nak: NAKS[period.nakIdx].name
};
cursor = padaEnd;
}
return {padaIdx:-1,pada:null,nak:null};
}

// Tree expand/collapse
window.expandDasa = function(idx) {
openState.dasa = (openState.dasa === idx ? null : idx);
openState.puthi = null; openState.anthara = null; renderAll();
};
window.expandPuthi = function(idx) {
openState.puthi = (openState.puthi === idx ? null : idx);
openState.anthara = null; renderAll();
};



function showDasaForPlanet(planetName) {
  const deg = window.planetDegrees[planetName];
  if (deg == null) {
    alert(`No degree for ${planetName}`);
    return;
  }
  // Convert decimal degree to DMS
  const d = Math.floor(deg);
  const mFloat = (deg - d) * 60;
  const m = Math.floor(mFloat);
  const s = Math.round((mFloat - m) * 60);
  document.getElementById("moon_deg").value = d;
  document.getElementById("moon_min").value = m;
  document.getElementById("moon_sec").value = s;
  run();
}


function placePlanetsOnChart(planets) {
  if (!planets) return;
  const planetCodes = {
    Ascendant:"ро▓", Sun: "роЪрпВ", Moon: "роЪроирпН", Mercury: "рокрпБ", Venus: "роЪрпБ",
    Mars: "роЪрпЖ", Jupiter: "роХрпБ", Saturn: "роЪ", Rahu: "ро░ро╛", Ketu: "роХрпЗ"
  };
  function getGlobalPada(decDeg) {
    const totalDegrees = decDeg % 360;
    const padaSizeDeg = 360 / 108;
    return Math.floor(totalDegrees / padaSizeDeg) + 1;
  }
  Object.entries(planets).forEach(([key, obj]) => {
    if (obj.fullDegree != null) {
      const idx = getGlobalPada(obj.fullDegree);
      const cell = padaDomList[idx];
      if (cell) {
        const existing = cell.querySelector(`.planet-${key}`);
        if (existing) existing.remove();
        const span = document.createElement("span");
        span.textContent = planetCodes[key] || key.slice(0,2);
        span.className = `planet-${key}`;
        span.style.cssText = "font-size:0.9em; margin-left:4px; color:#d22;";
        cell.appendChild(span);
      }
    }
  });
}

function run() {
mode = "current";
setActiveModeBtn('btn-current');
let dobStr = document.getElementById("dob").value;
let mdeg = parseInt(document.getElementById("moon_deg").value) || 0;
let mmin = parseInt(document.getElementById("moon_min").value) || 0;
let msec = parseInt(document.getElementById("moon_sec").value) || 0;
let moon = mdeg + mmin / 60 + msec / 3600;
if(isNaN(moon) || moon < 0 || moon >= 360) {
alert("роЪроирпНродро┐ро░ройрпН роирпАро│роорпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.");
return;
}


let dob = new Date(dobStr);
if(isNaN(dob.getTime())) {
alert("рокро┐ро▒роирпНрод родрпЗродро┐ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН.");
return;
}
let caldateStr = document.getElementById("caldate").value;
let now = caldateStr ? new Date(caldateStr) : new Date();
vimData = dasaTree(moon, dob, now);
vimCurrentPath = findCurrentPath(vimData);
drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
}


openState = {dasa: vimCurrentPath.dasa, puthi: vimCurrentPath.puthi, anthara: vimCurrentPath.anth};
renderAll(now);
// Get lagna degree from user input
const deg = parseInt(document.getElementById("lagna_deg").value) || 0;
const min = parseInt(document.getElementById("lagna_min").value) || 0;
const sec = parseInt(document.getElementById("lagna_sec").value) || 0;
const totalDegree = deg + (min / 60) + (sec / 3600);

const padaIndex = getLagnaPadaIndex(totalDegree);

// Highlight and trigger bhavam function (assuming it accepts pada index)
highlightPadaRange3(padaIndex);

// After drawChartGrid() or renderAll();
let moon_deg = Number(document.getElementById("moon_deg").value);
let moon_min = Number(document.getElementById("moon_min").value);
let moon_sec = Number(document.getElementById("moon_sec").value);
let globalPada = getMoonPadaIndex(moon_deg, moon_min, moon_sec);
placeMoonSymbolToPada(globalPada);



}

drawChartGrid();
if (window.savedPlanetsForChart) {
  placePlanetsOnChart(window.savedPlanetsForChart);
}

</script>
</body>
</html>
